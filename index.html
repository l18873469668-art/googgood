<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ„ åœ£è¯æ ‘ (V5 æ ¸å¼¹ç‰ˆ)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        #loading { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: yellow; font-size: 20px; font-family: sans-serif;
            pointer-events: none;
        }
        #ui {
            position: fixed; bottom: 20px; left: 0; width: 100%; text-align: center;
            pointer-events: none;
        }
        button {
            pointer-events: auto; padding: 10px 20px; background: gold; border: none;
            border-radius: 5px; font-weight: bold; font-size: 16px;
        }
    </style>
</head>
<body>

    <div id="loading">æ­£åœ¨åŠ è½½ 3D å¼•æ“...</div>
    <div id="ui">
        <button onclick="document.getElementById('file').click()">ğŸ“· å¦‚æœèƒ½çœ‹åˆ°æ ‘ï¼Œç‚¹æˆ‘æ¢ç…§ç‰‡</button>
        <input type="file" id="file" multiple accept="image/*" style="display:none">
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // 2. è¿™é‡Œçš„ä»£ç ä¼šåœ¨ Three.js åŠ è½½å®Œåç«‹å³è¿è¡Œ
        window.onload = function() {
            document.getElementById('loading').style.display = 'none';
            initGame();
        };

        function initGame() {
            // --- åŸºç¡€ä¸‰å¤§ä»¶ ---
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505); // èƒŒæ™¯è‰²ï¼šé»‘

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 30;
            camera.position.y = 10;
            camera.lookAt(0, 0, 0);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // --- ç¯å…‰ (æ²¡æœ‰ç¯å°±æ˜¯é»‘çš„) ---
            const light = new THREE.AmbientLight(0xffffff, 1); // ç¯å¢ƒå…‰
            scene.add(light);
            const pLight = new THREE.PointLight(0xffd700, 1, 100); // ç‚¹å…‰æº
            pLight.position.set(10, 20, 10);
            scene.add(pLight);

            // --- ç«‹åˆ»é€ ä¸€æ£µæ ‘ (ä¸ä¾èµ–ç…§ç‰‡) ---
            const group = new THREE.Group();
            const geometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);
            // é»˜è®¤æè´¨ï¼šç»¿è‰²å‘å…‰
            const material = new THREE.MeshStandardMaterial({ color: 0x00ff00, roughness: 0.5 });
            
            const cubes = [];

            for(let i=0; i<300; i++) {
                const mesh = new THREE.Mesh(geometry, material);
                
                // æ ‘çš„å½¢çŠ¶ç®—æ³•
                const y = (Math.random() * 40) - 20; // é«˜åº¦ -20 åˆ° 20
                const radius = (1 - (y + 20) / 40) * 15; // ä¸‹é¢å®½ä¸Šé¢çª„
                const angle = Math.random() * Math.PI * 2;
                
                mesh.position.set(
                    Math.cos(angle) * radius, 
                    y, 
                    Math.sin(angle) * radius
                );
                
                // éšæœºæ—‹è½¬ä¸€ä¸‹
                mesh.rotation.set(Math.random(), Math.random(), Math.random());
                
                group.add(mesh);
                cubes.push(mesh);
            }
            scene.add(group);

            // --- åŠ¨ç”»å¾ªç¯ ---
            function animate() {
                requestAnimationFrame(animate);
                
                // è®©æ ‘ä¸€ç›´æ—‹è½¬
                group.rotation.y += 0.005;
                
                renderer.render(scene, camera);
            }
            animate();

            // --- ä¸Šä¼ ç…§ç‰‡é€»è¾‘ ---
            document.getElementById('file').onchange = function(e) {
                const files = e.target.files;
                if(files.length > 0) {
                    const textureLoader = new THREE.TextureLoader();
                    // éå†æ‰€æœ‰æ–¹å—ï¼Œéšæœºè´´å›¾
                    cubes.forEach((mesh, index) => {
                        const file = files[index % files.length]; // å¾ªç¯å–ç…§ç‰‡
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            const img = new Image();
                            img.src = event.target.result;
                            const tex = textureLoader.load(img.src);
                            // æ¢æˆç…§ç‰‡æè´¨
                            mesh.material = new THREE.MeshBasicMaterial({ map: tex });
                        };
                        reader.readAsDataURL(file);
                    });
                    alert("ç…§ç‰‡æ­£åœ¨è´´ä¸Šå»ï¼Œè¯·çœ‹å±å¹•ï¼");
                }
            };

            // --- çª—å£å¤§å°æ”¹å˜ ---
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // --- ç®€å•çš„è§¦æ‘¸æ—‹è½¬ (æ‰‹æŒ‡æ‹–åŠ¨) ---
            let isDragging = false;
            let previousTouchX = 0;
            
            document.addEventListener('touchstart', e => {
                isDragging = true;
                previousTouchX = e.touches[0].clientX;
            });
            
            document.addEventListener('touchmove', e => {
                if(isDragging) {
                    const delta = e.touches[0].clientX - previousTouchX;
                    group.rotation.y += delta * 0.01;
                    previousTouchX = e.touches[0].clientX;
                }
            });
            
            document.addEventListener('touchend', () => isDragging = false);
        }
    </script>
</body>
</html>
